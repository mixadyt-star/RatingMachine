{%set server_origin = variables["server_origin"]%}
<div class="wrapper">
    <div class="shadow-block">
        <div class="grid login-grid">
            <p class="grid-item text x-large login-text-grid-item">
                Войдите
            </p>
            <div class="grid-item wrapper input-wrapper login-email-grid-item">
                <label class="text" for="email-input" type="email">
                    Почта
                </label>
                <input class="input-text" id="email-input" name="email" placeholder="Ваша почта...">
            </div>
            <script>
                function password_eye_click(password_id, eye_id) {
                    password_input = document.getElementById(password_id)
                    password_eye = document.getElementById(eye_id)

                    if (password_input.type == "password") {
                        password_input.type = "text"
                        password_eye.innerHTML = `
                        <path d="M19.5 16L17.0248 12.6038" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 17.5V14" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M4.5 16L6.96895 12.6124" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M3 8C6.6 16 17.4 16 21 8" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                        `
                    } else {
                        password_input.type = "password"
                        password_eye.innerHTML = `
                        <path d="M3 13C6.6 5 17.4 5 21 13" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                        <path d="M12 17C10.3431 17 9 15.6569 9 14C9 12.3431 10.3431 11 12 11C13.6569 11 15 12.3431 15 14C15 15.6569 13.6569 17 12 17Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                        `
                    }
                }
            </script>
            <div class="grid-item wrapper input-wrapper login-password-grid-item">
                <label class="text" for="password-input">
                    Пароль
                </label>
                <input class="input-text password-input" id="password-input" name="password" placeholder="Ваш пароль от аккаунта..." type="password">
                <svg 
                    width="24" 
                    height="24" 
                    viewBox="0 0 24 24" 
                    stroke-width="2" 
                    fill="none" 
                    xmlns="http://www.w3.org/2000/svg"
                    class="password-eye-icon"
                    id="password-eye"
                    onclick="password_eye_click('password-input', 'password-eye')"
                >
                    <path d="M3 13C6.6 5 17.4 5 21 13" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M12 17C10.3431 17 9 15.6569 9 14C9 12.3431 10.3431 11 12 11C13.6569 11 15 12.3431 15 14C15 15.6569 13.6569 17 12 17Z" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <script>
                async function sha256(message) {
                    const msgBuffer = new TextEncoder().encode(message);                    
                    const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
                    const hashArray = Array.from(new Uint8Array(hashBuffer));               
                    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
                    return hashHex;
                }

                async function check_login() {
                    error_text = document.getElementById("error-text")
                    error_text.setAttribute("style", "visibility: hidden;")

                    submit_button = document.getElementById("submit-login")
                    submit_button.innerHTML = '<div class="loader"></div>'
                    submit_button.disabled = true

                    email = document.getElementById("email-input").value
                    password = await sha256(document.getElementById("password-input").value)

                    fetch("{{ server_origin }}/login", {
                        method: "POST",
                        body: JSON.stringify({
                          type: "Teacher",
                          email: email,
                          password: password
                        }),
                        headers: {
                          "Content-type": "application/json; charset=UTF-8"
                        }
                      })
                        .then((response) => response.json())
                        .then(function (json) {
                            if (json["error"]) {
                                error_text.innerText = json["error_message"]
                                error_text.setAttribute("style", "visibility: visible;")
                                submit_button.disabled = false

                                submit_button.innerText = "Войти"
                            } else {
                                if (json["payload"]["login"] == true) {
                                    window.location.href = "{{ server_origin }}/"
                                }
                            }
                        });
                }
            </script>
            <div class="grid-item wrapper input-wrapper login-submit-grid-item">
                <button class="input-text text input-submit" id="submit-login" onclick="check_login()">
                    Войти
                </button>
            </div>
            <p class="grid-item text login-error-text login-error-grid-item" id="error-text">
                Ошибка
            </p>
        </div>
    </div>
</div>